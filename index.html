<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç½‘ç»œæ”¶è—å¤¹ - æ‰“å¡ç³»ç»Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow p-6">
    <h1 class="text-2xl font-bold mb-4">ğŸ“Œ ç½‘ç»œæ”¶è—å¤¹</h1>

    <div class="flex gap-4 mb-4">
      <button onclick="signUp()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">æ³¨å†Œ</button>
      <button onclick="signIn()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ç™»å½•</button>
      <button onclick="signOut()" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">ç™»å‡º</button>
    </div>

    <div class="flex flex-col md:flex-row gap-4 mb-4">
      <input id="bookmarkName" type="text" placeholder="åç§°" class="flex-1 px-4 py-2 border rounded" />
      <input id="bookmarkURL" type="url" placeholder="ç½‘å€ï¼Œå¦‚ï¼šhttps://..." class="flex-1 px-4 py-2 border rounded" />
      <input id="bookmarkTags" placeholder="æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”" class="flex-1 px-4 py-2 border rounded" />
      <button onclick="saveBookmark()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ä¿å­˜</button>
    </div>

    <input id="searchBox" type="text" placeholder="ğŸ” æœç´¢åç§°æˆ–æ ‡ç­¾" class="w-full px-3 py-2 border mb-4 rounded" oninput="renderFilteredBookmarks(this.value)" />
    <div id="categoryTabs" class="flex gap-2 mb-4 overflow-x-auto text-sm"></div>
    <div id="bookmarkList" class="space-y-4"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBTkLZxOypQwmzeLnihgyAxrczNLgq-J6I",
      authDomain: "webn-25f57.firebaseapp.com",
      projectId: "webn-25f57",
      storageBucket: "webn-25f57.firebasestorage.app",
      messagingSenderId: "472156580131",
      appId: "1:472156580131:web:3a42f16d8b450149a20496",
      measurementId: "G-E5E4TBGL5D"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let bookmarks = [];
    let categories = {};

    function signUp() {
      const email = prompt("è¯·è¾“å…¥é‚®ç®±");
      const password = prompt("è¯·è¾“å…¥å¯†ç ");
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => alert("æ³¨å†ŒæˆåŠŸï¼"))
        .catch(error => alert(error.message));
    }

    function signIn() {
      const email = prompt("è¯·è¾“å…¥é‚®ç®±");
      const password = prompt("è¯·è¾“å…¥å¯†ç ");
      auth.signInWithEmailAndPassword(email, password)
        .then(() => alert("ç™»å½•æˆåŠŸï¼"))
        .catch(error => alert(error.message));
    }

    function signOut() {
      auth.signOut().then(() => {
        currentUser = null;
        bookmarks = [];
        categories = {};
        renderBookmarks();
        renderCategories();
        alert("å·²ç™»å‡º");
      });
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        loadBookmarks();
      }
    });

    const categorize = (url) => {
      if (url.includes("youtube") || url.includes("bilibili")) return "è§†é¢‘";
      if (url.includes("zhihu") || url.includes("medium") || url.includes("wikipedia")) return "å­¦ä¹ ";
      if (url.includes("weibo") || url.includes("twitter") || url.includes("facebook")) return "ç¤¾äº¤";
      if (url.includes("chat.openai")) return "AI å·¥å…·";
      return "å…¶ä»–";
    };

    function saveBookmark() {
      if (!currentUser) return alert("è¯·å…ˆç™»å½•ï¼");
      const name = document.getElementById("bookmarkName").value.trim();
      const url = document.getElementById("bookmarkURL").value.trim();
      const tagsInput = document.getElementById("bookmarkTags").value.trim();
      const tags = tagsInput ? tagsInput.split(",").map(t => t.trim()) : [];
      if (!name || !url) return alert("è¯·è¾“å…¥åç§°å’Œç½‘å€");

      const category = categorize(url);
      const bookmark = { name, url, tags, category, createdAt: new Date().toISOString() };

      db.collection("bookmarks").doc(currentUser.uid).collection("items").add(bookmark)
        .then(() => {
          alert("ä¹¦ç­¾å·²ä¿å­˜");
          loadBookmarks();
        })
        .catch(error => alert(error.message));

      document.getElementById("bookmarkName").value = '';
      document.getElementById("bookmarkURL").value = '';
      document.getElementById("bookmarkTags").value = '';
    }

    function loadBookmarks() {
      if (!currentUser) return;
      db.collection("bookmarks").doc(currentUser.uid).collection("items").get()
        .then(snapshot => {
          bookmarks = [];
          categories = {};
          snapshot.forEach(doc => {
            const data = doc.data();
            data.id = doc.id;
            bookmarks.push(data);
            if (!categories[data.category]) categories[data.category] = [];
            categories[data.category].push(data);
          });
          renderCategories();
          renderBookmarks();
        })
        .catch(error => alert(error.message));
    }

    function renderCategories() {
      const tabs = document.getElementById("categoryTabs");
      tabs.innerHTML = "";
      Object.keys(categories).forEach(cat => {
        const btn = document.createElement("button");
        btn.innerText = cat;
        btn.className = "px-3 py-1 rounded bg-gray-200 hover:bg-gray-300";
        btn.onclick = () => renderBookmarks(cat);
        tabs.appendChild(btn);
      });
    }

    function renderFilteredBookmarks(query) {
      const list = document.getElementById("bookmarkList");
      list.innerHTML = "";
      const result = bookmarks.filter(b =>
        b.name.includes(query) ||
        b.url.includes(query) ||
        (b.tags && b.tags.some(tag => tag.includes(query)))
      );
      if (result.length === 0) {
        list.innerHTML = "<p class='text-gray-400'>æ²¡æœ‰åŒ¹é…çš„æ”¶è—</p>";
        return;
      }
      result.forEach(b => renderBookmarkCard(b, list));
    }

    function renderBookmarks(category = null) {
      const list = document.getElementById("bookmarkList");
      list.innerHTML = "";
      const items = category ? categories[category] : bookmarks;
      if (!items.length) {
        list.innerHTML = "<p class='text-gray-500'>æš‚æ— æ”¶è—</p>";
        return;
      }
      items.forEach(b => renderBookmarkCard(b, list));
    }

    function renderBookmarkCard(b, container) {
      const card = document.createElement("div");
      card.className = "bookmark-card p-4 border rounded shadow-sm bg-white flex justify-between items-center";
      card.dataset.url = b.url;

      const info = document.createElement("div");
      info.innerHTML = `<div class="font-semibold">${b.name}</div>
                        <div class="text-sm text-gray-500">${b.url}</div>
                        <div class="text-xs text-gray-400">æ ‡ç­¾: ${b.tags?.join(', ') || 'æ— '}</div>`;

      const visitBtn = document.createElement("a");
      visitBtn.href = b.url;
      visitBtn.target = "_blank";
      visitBtn.innerText = "è®¿é—®";
      visitBtn.className = "bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600";

      card.appendChild(info);
      card.appendChild(visitBtn);
      container.appendChild(card);
    }
  </script>
</body>
</html>
